package com.codenjoy.dojo.battlecity;

import com.codenjoy.dojo.battlecity.client.Board;
import com.codenjoy.dojo.battlecity.client.ai.ApofigSolver;
import com.codenjoy.dojo.battlecity.services.GameRunner;
import com.codenjoy.dojo.client.LocalGameRunner;
import com.codenjoy.dojo.services.Dice;
import com.codenjoy.dojo.services.RandomDice;
import org.junit.Test;

import javax.print.Doc;
import java.util.LinkedList;
import java.util.List;

import static org.junit.Assert.assertEquals;
import static org.mockito.Matchers.anyInt;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

public class SmokeTest {
    @Test
    public void test() {
        // given
        List<String> messages = new LinkedList<>();

        LocalGameRunner.timeout = 0;
        LocalGameRunner.out = (e) -> messages.add(e);
        LocalGameRunner.countIterations = 15;

        Dice dice = mock(Dice.class);
        when(dice.next(anyInt())).thenReturn(1);

        GameRunner gameType = new GameRunner() {
            @Override
            protected Dice getDice() {
                return dice;
            }

            @Override
            public String getMap() {
                return  "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼" +
                        "☼¿ ¿ ¿   ¿ ¿ ¿☼" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼" +
                        "☼ ╬ ╬ ╬☼╬ ╬ ╬ ☼" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼" +
                        "☼ ╬ ╬     ╬ ╬ ☼" +
                        "☼     ╬ ╬     ☼" +
                        "☼☼ ╬╬     ╬╬ ☼☼" +
                        "☼     ╬ ╬     ☼" +
                        "☼ ╬ ╬ ╬╬╬ ╬ ╬ ☼" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼" +
                        "☼ ╬         ╬ ☼" +
                        "☼ ╬   ╬╬╬   ╬ ☼" +
                        "☼     ╬ ╬     ☼" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼";
            }
        };

        // when
        LocalGameRunner.run(gameType,
                new ApofigSolver(null),
                new Board());

        // then
        assertEquals("Board:\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "☼¿ ¿ ¿   ¿ ¿ ¿☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬☼╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬     ╬ ╬ ☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼☼ ╬╬     ╬╬ ☼☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼ ╬ ╬ ╬╬╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬         ╬ ☼\n" +
                        "☼ ╬   ╬╬╬   ╬ ☼\n" +
                        "☼▲    ╬ ╬     ☼\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "\n" +
                        "Answer: DOWN, ACT\n" +
                        "------------------------------------------------------------------------------------\n" +
                        "Board:\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "☼             ☼\n" +
                        "☼¿╬¿╬¿╬ ╬¿╬¿╬¿☼\n" +
                        "☼•╬•╬•╬☼╬•╬•╬•☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬     ╬ ╬ ☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼☼ ╬╬     ╬╬ ☼☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼ ╬ ╬ ╬╬╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬         ╬ ☼\n" +
                        "☼ ╬   ╬╬╬   ╬ ☼\n" +
                        "☼▼    ╬ ╬     ☼\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "\n" +
                        "Answer: ACT\n" +
                        "------------------------------------------------------------------------------------\n" +
                        "Board:\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "☼             ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼¿╬¿╬¿╬☼╬¿╬¿╬¿☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼•╬•╬•   •╬•╬•☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼☼ ╬╬     ╬╬ ☼☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼ ╬ ╬ ╬╬╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬         ╬ ☼\n" +
                        "☼ ╬   ╬╬╬   ╬ ☼\n" +
                        "☼▼    ╬ ╬     ☼\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "\n" +
                        "Answer: ACT\n" +
                        "------------------------------------------------------------------------------------\n" +
                        "Board:\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "☼             ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬☼╬ ╬ ╬ ☼\n" +
                        "☼¿╬¿╬¿╬ ╬¿╬¿╬¿☼\n" +
                        "☼ ╬ ╬     ╬ ╬ ☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼☼ ╦╬•   •╬╦ ☼☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼ ╬ ╬ ╬╬╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬         ╬ ☼\n" +
                        "☼ ╬   ╬╬╬   ╬ ☼\n" +
                        "☼▼    ╬ ╬     ☼\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "\n" +
                        "Answer: DOWN, ACT\n" +
                        "------------------------------------------------------------------------------------\n" +
                        "Board:\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "☼             ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬☼╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼¿╬¿╬¿   ¿╬¿╬¿☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼☼ ╦╬     ╬╦ ☼☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼ ╬ ╬•╬╬╬•╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬         ╬ ☼\n" +
                        "☼ ╬   ╬╬╬   ╬ ☼\n" +
                        "☼▼    ╬ ╬     ☼\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "\n" +
                        "Answer: DOWN, ACT\n" +
                        "------------------------------------------------------------------------------------\n" +
                        "Board:\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "☼             ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬☼╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬     ╬ ╬ ☼\n" +
                        "☼¿ ¿ ¿╬ ╬¿ ¿ ¿☼\n" +
                        "☼☼ ╦╬     ╬╦ ☼☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼ ╬ ╬ ╬╬╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬  •   •  ╬ ☼\n" +
                        "☼ ╬   ╬╬╬   ╬ ☼\n" +
                        "☼▼    ╬ ╬     ☼\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "\n" +
                        "Answer: DOWN, ACT\n" +
                        "------------------------------------------------------------------------------------\n" +
                        "Board:\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "☼             ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬☼╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬     ╬ ╬ ☼\n" +
                        "☼ » » ╬ ╬   »»☼\n" +
                        "☼☼ ╦╬¿   ¿╬╦ ☼☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼ ╬ ╬ ╬╬╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬         ╬ ☼\n" +
                        "☼ ╬   ╬╬╬   ╬ ☼\n" +
                        "☼▼   •╬ ╬•    ☼\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "\n" +
                        "Answer: DOWN, ACT\n" +
                        "------------------------------------------------------------------------------------\n" +
                        "Board:\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "☼             ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬☼╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬     ╬ ╬ ☼\n" +
                        "☼  » »╬ ╬   »»☼\n" +
                        "☼☼ ╦╬     ╬╦ ☼☼\n" +
                        "☼    ¿╬ ╬¿    ☼\n" +
                        "☼ ╬ ╬ ╬╬╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬         ╬ ☼\n" +
                        "☼ ╬   ╬╬╬   ╬ ☼\n" +
                        "☼▼    ╬ ╬     ☼\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "\n" +
                        "Answer: DOWN, ACT\n" +
                        "------------------------------------------------------------------------------------\n" +
                        "Board:\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "☼             ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬☼╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬     ╬ ╬ ☼\n" +
                        "☼   »»╬ ╬   »»☼\n" +
                        "☼☼ ╦╬     ╬╦ ☼☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼ ╬ ╬¿╬╬╬¿╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬         ╬ ☼\n" +
                        "☼ ╬   ╬╬╬   ╬ ☼\n" +
                        "☼▼    ╬ ╬     ☼\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "\n" +
                        "Answer: RIGHT, ACT\n" +
                        "------------------------------------------------------------------------------------\n" +
                        "Board:\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "☼             ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬☼╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬     ╬ ╬ ☼\n" +
                        "☼   »»╬ ╬   »»☼\n" +
                        "☼☼ ╦╬     ╬╦ ☼☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼ ╬ ╬ ╬╬╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬¿╬ ╬¿╬ ╬ ☼\n" +
                        "☼ ╬         ╬ ☼\n" +
                        "☼ ╬   ╬╬╬   ╬ ☼\n" +
                        "☼ ►•  ╬ ╬     ☼\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "\n" +
                        "Answer: LEFT, ACT\n" +
                        "------------------------------------------------------------------------------------\n" +
                        "Board:\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "☼             ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬☼╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬     ╬ ╬ ☼\n" +
                        "☼   »»╬ ╬   »»☼\n" +
                        "☼☼ ╦╬     ╬╦ ☼☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼ ╬ ╬ ╬╬╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬  ¿   ¿  ╬ ☼\n" +
                        "☼ ╬   ╬╬╬   ╬ ☼\n" +
                        "☼◄   •╬ ╬     ☼\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "\n" +
                        "Answer: RIGHT, ACT\n" +
                        "------------------------------------------------------------------------------------\n" +
                        "Board:\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "☼             ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬☼╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬     ╬ ╬ ☼\n" +
                        "☼   »Ѡ╠ ╬   »Ѡ☼\n" +
                        "☼☼ ╦╬     ╬╦ ☼☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼ ╬ ╬ ╬╬╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬         ╬ ☼\n" +
                        "☼ ╬  ¿╬╬╬¿  ╬ ☼\n" +
                        "☼ ►  Ѡ╬ ╬•    ☼\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "\n" +
                        "Answer: RIGHT, ACT\n" +
                        "------------------------------------------------------------------------------------\n" +
                        "Board:\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "☼             ☼\n" +
                        "☼¿╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼•╬ ╬ ╬☼╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬     ╬ ╬ ☼\n" +
                        "☼    »╠ ╬    »☼\n" +
                        "☼☼ ╦╬     ╬╦ ☼☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼ ╬ ╬ ╬╬╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬         ╬ ☼\n" +
                        "☼ ╬   ╬╬╬   ╬ ☼\n" +
                        "☼  ► ¿╬ ╬¿    ☼\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "\n" +
                        "Answer: RIGHT, ACT\n" +
                        "Fire Event: KILL_OTHER_TANK\n" +
                        "------------------------------------------------------------------------------------\n" +
                        "Board:\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "☼             ☼\n" +
                        "☼¿╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼Ѡ╬ ╬ ╬☼╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼•╬ ╬     ╬ ╬ ☼\n" +
                        "☼    »╠ ╬    »☼\n" +
                        "☼☼ ╦╬     ╬╦ ☼☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼ ╬ ╬ ╬╬╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬         ╬ ☼\n" +
                        "☼ ╬   ╬╬╬   ╬ ☼\n" +
                        "☼   ►Ѡ╬ ╬ »   ☼\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "\n" +
                        "Answer: DOWN, ACT\n" +
                        "------------------------------------------------------------------------------------\n" +
                        "Board:\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "☼             ☼\n" +
                        "☼¿╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼Ѡ╬ ╬ ╬☼╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬     ╬ ╬ ☼\n" +
                        "☼    »╠ ╬    »☼\n" +
                        "☼☼ ╦╬     ╬╦ ☼☼\n" +
                        "☼     ╬ ╬     ☼\n" +
                        "☼ ╬ ╬ ╬╬╬ ╬ ╬ ☼\n" +
                        "☼ ╬ ╬ ╬ ╬ ╬ ╬ ☼\n" +
                        "☼ ╬         ╬ ☼\n" +
                        "☼ ╬   ╬╬╬   ╬ ☼\n" +
                        "☼   ▼ ╬ ╬  »  ☼\n" +
                        "☼☼☼☼☼☼☼☼☼☼☼☼☼☼☼\n" +
                        "\n" +
                        "Answer: DOWN, ACT\n" +
                        "------------------------------------------------------------------------------------",
                String.join("\n", messages));

    }
}
